# 자바 Thread
- 자바에서 멀티 스레딩을 구현하려면?
- 자바에서 Thread 클래스는 어떻게 사용할까?
<br></br>

## 멀티 스레딩
- 하나의 프로세스 안에서 여러 스레드가 동시에 작업을 수행하는 일.

- 보통 한 개의 프로세스는 한 가지 일을 하지만, 스레드를 이용하면 한 프로세스 내에서 두 가지 이상의 일을 동시에 할 수 있다.

- 각 코어는 짧은 시간 동안 여러 프로세스를 번갈아가며 처리하며, 스레드는 그 중 하나의 작업 단위를 나타낸다.
<br></br>

## Thread 클래스
- 두 가지 방식을 사용해서 스레드를 구현할 수 있다.

- 아래의 방식을 통해 `run()` 메소드를 오버라이드 한다.

    1. `Runnable` 인터페이스 구현
        - 이 경우, 해당 클래스를 인스턴스화 해서 `Thread` 생성자에 argument로 넘겨줘야 한다.

        - `run()`을 호출하면 `Runnable` 인터페이스의 `run()`이 호출되므로 별도의 오버라이딩이 없어도 된다.

        - `currentThread()`를 호출하여 참조를 얻어와야만 스레드 클래스의 메소드를 사용할 수 있다는 번거로움이 있다.

        -   ```
            public static void main(String[] args){
                Runnable r = new MyThread();
                Thread t = new Thread(r, "mythread");
            }
            ```

    2. `Thread` 클래스 상속
        - 상속받은 클래스 자체를 스레드로 사용할 수 있다.

        - `Runnable` 구현 방식과는 반대로, 스레드 클래스의 메소드(`getName()` 등)를 바로 사용할 수 있다.

<br></br>

## 스레드의 실행
- Thread 클래스는 `start()` 실행시 `run()` 메소드가 수행되도록 내부적으로 동작한다.

- 따라서 `run()`이 아닌 `start()`로 스레드를 실행시킨다.

- `start()`는 스레드가 작업을 실행하는 데 필요한 **콜 스택(Call Stack)을 생성**한 다음, `run()`을 호출해서 그 **스택 안에 `run()`을 저장**할 수 있도록 해준다.
    - 콜 스택은 실질적인 명령어를 담고 있는 메모리로, 이곳에서 명령을 하나씩 꺼내어 실행한다.

    - `run()`을 호출하면 콜 스택을 단 하나만 이용하는 것이므로 진정한 의미의 멀티 스레딩이 아니다. **JVM이 다수의 콜 스택을 번갈아가며 처리**(Context Switching)하는 것이 옳다.
<br></br>

## 스레드의 실행제어
- 스레드의 5가지 상태
    - `NEW` : 스레드가 생성되고 아직 `start()`가 호출되지 않은 상태
    - `RUNNABLE` : 실행 중 또는 실행 가능 상태
    - `BLOCKED` : 등기화 블럭에 의한 일시정지 상태(lock된 상태)
    - `WATING(TIME_WATING)` : 실행가능하지 않은 일시정지 상태
    - `TERMINATED` : 스레드 작업이 종료된 상태

- `start()` 이후에 반복문(그리고 try-catch) 안에서 `join()`을 사용하지 않으면 모든 스레드가 종료되기 전에 main 메서드가 종료된다. 

    - 따라서 모든 스레드가 종료된 후 main을 종료시키려면 `join()`을 호출한다.
<br></br>

## 동기화
- 여러 스레드가 같은 프로세스 내의 자원을 공유하면서, 서로의 작업이 다른 작업에 영향을 주곤 한다. 따라서 동기화가 필요하다.

- 임계영역(Critical section)과 잠금(Lock)을 활용하여 동기화를 구현한다.

- 임계영역을 지정하고, lock을 단 하나의 스레드에게만 빌려준다. 임계영역 안의 코드를 모두 수행하면 lock을 반납한다.

- 동기화 방법
    - `임계 영역(Critical section)` : 공유 자원에 단 하나의 스레드만 접근하도록 하는 방법 *(단, 하나의 프로세스에 속한 스레드만 가능)*

    - `뮤텍스(Mutex)` : 공유 자원에 단 하나의 스레드만 접근하도록 하는 방법 *(서로 다른 프로세스에 속한 스레드도 가능)*

    - `이벤트(Event)` : 특정한 사건 발생을 다른 스레드에게 알리는 방법

    - `세마포어(Semaphore)` : 한정된 개수의 자원을 여러 스레드가 사용하려 할 때 접근 제한을 하는 방법

    - `대기 가능 타이머(Waitable timer)` : 특정 시간이 되면 대기중이던 스레드를 깨우는 방법
<br></br>

## synchronized 활용
- `synchronized`를 활용하여 임계 영역을 설정할 수 있다.

- 서로 다른 두 객체가 동기화를 하지 않은 메소드를 동시에 오버라이딩해서 이용하면, 두 스레드가 동시에 처리되므로 출력값의 오류가 발생할 수 있다.
    - 이때, 오버라이딩 되는 수퍼 클래스의 메소드에 `synchronized` 키워드를 붙여 임계 영역을 설정해주면 해결할 수 있다. (공유 자원을 lock) 
<br></br>

### 출처
- https://wikidocs.net/230 (점프 투 자바)
- https://github.com/gyoogle/tech-interview-for-developer/blob/master/Language/%5Bjava%5D%20Java%EC%97%90%EC%84%9C%EC%9D%98%20Thread.md